@page "/contactcard"
@using Microsoft.AspNetCore.Components.Forms
@using static QRCoder.PayloadGenerator;

<MudText Typo="Typo.h3" Class="my-8" Align="Align.Center">Generate Contact Card</MudText>

<MudContainer Class="my-6">
    <EditForm Model="contactInformation" OnValidSubmit="CreateVCard">
        <MudGrid Spacing="5" Justify="Justify.Center">
            <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.FirstName" Label="First Name"></MudTextField>
            </MudItem>
            <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.LastName" Label="Last Name"></MudTextField>
            </MudItem>
            <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.NickName" Label="Nick Name"></MudTextField>
            </MudItem>
 
              <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.Organization" Label="Organization"></MudTextField>
            </MudItem>
            <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.OrgTitle" Label="Organization Title"></MudTextField>
            </MudItem>
     
              <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.Phone" Label="Phone"></MudTextField>
            </MudItem>
            <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.MobilePhone" Label="Mobile Phone"></MudTextField>
            </MudItem>
            <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.WorkPhone" Label="Work Phone"></MudTextField>
            </MudItem>
              <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.Email" InputType="InputType.Email" Label="Email"></MudTextField>
            </MudItem>
            <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.Website" InputType="InputType.Url" Label="Website"></MudTextField>
            </MudItem>

            <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.Street" Label="Street"></MudTextField>
            </MudItem>
              <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.HouseNumber" Label="House number"></MudTextField>
            </MudItem>
            <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.City" Label="City"></MudTextField>
            </MudItem>
              <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.State" Label="State / Province"></MudTextField>
            </MudItem>
              <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.Zipcode" Label="Zipcode"></MudTextField>
            </MudItem>
            <MudItem xs="12" sm="12" md="12">
                <MudTextField @bind-Value="contactInformation.Country" Label="Country"></MudTextField>
            </MudItem>
            <MudItem xs="6" sm="6" md="6">
                <MudButton ButtonType="ButtonType.Submit" Color="Color.Primary" Variant="Variant.Outlined"><MudText>Submit</MudText></MudButton>
            </MudItem>
            <MudItem xs="6" sm="6" md="6">
                <MudButton OnClick="Reset" Color="Color.Secondary" Variant="Variant.Text"><MudText>Reset</MudText></MudButton>
            </MudItem>
        </MudGrid>
    </EditForm>
</MudContainer>

<MudContainer Class="d-flex flex-column justify-center gap-5 my-6">
    @if (!string.IsNullOrEmpty(qrImage))
    {
        <a href="@qrImage" download="QR Code">
            <MudImage Width="300" Height="300" Src="@qrImage" Alt="QR Code" Elevation="5" Class="rounded-lg" />
        </a>
        <MudText Typo="Typo.caption">click or tap on the image to download</MudText>
    }
</MudContainer>


@code {
    ContactInformation contactInformation = new();
    string qrImage = string.Empty;
    public void CreateVCard()
    {
        ContactData generator = new ContactData(
            ContactData.ContactOutputType.VCard3,
            firstname:contactInformation.FirstName,
            lastname:contactInformation.LastName,
            nickname:contactInformation.NickName,
            org:contactInformation.Organization,
            orgTitle:contactInformation.OrgTitle,
            phone:contactInformation.Phone,
            workPhone:contactInformation.WorkPhone,
            mobilePhone:contactInformation.MobilePhone,
            email: contactInformation.Email,
            website: contactInformation.Website,
            street: contactInformation.Street,
            houseNumber:contactInformation.HouseNumber,
            city: contactInformation.City,
            stateRegion: contactInformation.State,
            zipCode:contactInformation.Zipcode,
            country:contactInformation.Country
        );
        string payload = generator.ToString();
        qrImage = GenerateQRCode.GenerateQR(payload);
    }

    private void Reset()
    {
        contactInformation = new();
        qrImage = string.Empty;
        StateHasChanged();
    }
}
